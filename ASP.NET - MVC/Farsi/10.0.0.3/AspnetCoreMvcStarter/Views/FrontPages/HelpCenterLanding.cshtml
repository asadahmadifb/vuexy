@{
  // Layout = "_FrontLayout";
  ViewData["Title"] = "صفحات سایت - پشتیبانی";
}

@section PageStyles {
<link rel="stylesheet" href="~/vendor/css/pages/front-page-help-center.css" />
	<style>
		/* استایل برای باکس ورودی */
		.fixed-input-wrapper {
			position: fixed;
			bottom: 20px; /* فاصله از پایین */
			left: 50%;
			transform: translateX(-50%);
			width: 80%; /* عرض باکس */
			max-width: 600px; /* حداکثر عرض باکس */
			z-index: 1000; /* برای اطمینان از اینکه در بالای سایر عناصر قرار دارد */
		}
	</style>
}
<!-- Examples -->
<div class="row mb-0 h-100" style="height: 100vh;">
	<div class="col-md-12 col-lg-12 mb-0">
		<div class="card h-100">
			<div class="card-body d-flex flex-column">
				<!-- محتوای کارت -->
				<div class="flex-grow-1 overflow-auto" id="chatContainer" style="padding: 10px;">
@* 					<div id="chatOutput" class="mt-3"></div> <!-- جایی برای نمایش پیام‌ها -->
 *@				</div>

				<!-- بخش چت بات -->
				<div class="input-group mt-3">
					<input type="text" id="userInput" class="form-control" placeholder="پیام خود را اینجا وارد کنید" aria-label="پیام" />
					<button class="btn btn-primary" id="sendButton">ارسال</button>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	#chatContainer {
		height: 400px; /* ارتفاع چت */
		overflow-y: auto;
		border: 1px solid #ccc;
		padding: 10px;
		border-radius: 5px;
	}

	.message {
		margin: 5px 0;
	}

	.user {
		color: blue; /* رنگ متن پیام کاربر */
	}

	.ai {
		color: green; /* رنگ متن پیام هوش مصنوعی */
	}
</style>

<script>
	const sendButton = document.getElementById('sendButton');
	const userInput = document.getElementById('userInput');
	const chatOutput = document.getElementById('chatOutput');
	const chatContainer = document.getElementById('chatContainer');

	async function sendMessage() {
		const userMessage = userInput.value.trim();
		if (userMessage) {
			// نمایش پیام کاربر
			const userMessageElement = document.createElement('div');
			userMessageElement.textContent = `شما: ${userMessage}`;
				userMessageElement.innerHTML = `<div class="bubble user-bubble">${userMessage}</div>`;
				document.getElementById('chatContainer').appendChild(userMessageElement);

			// ارسال پیام به API
			const response = await fetch('https://app.station-ai.ir/api/v1/prediction/d251ac2b-59bc-4376-aceb-1c2bc50fc740', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ question: userMessage }),
			});
			console.log(response);
			if (response.ok) {
				const data = await response.json();
				// نمایش پاسخ هوش مصنوعی
					document.getElementById('chatContainer').innerHTML += `هوش مصنوعی: ${data.text}`;
				   userInput.value = '';
				   document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
			} else {
				// در صورت بروز خطا
				const errorElement = document.createElement('div');
				errorElement.textContent = 'خطا در دریافت پاسخ از سرور.';
				errorElement.className = 'ai-response';
				chatOutput.appendChild(errorElement);
			}

			// پاک کردن تکس باکس
			userInput.value = '';

			// اسکرول به پایین
			chatContainer.scrollTop = chatContainer.scrollHeight;
		}
	}

	// ارسال پیام با کلیک بر روی دکمه
	sendButton.addEventListener('click', sendMessage);

	// ارسال پیام با فشار دادن کلید Enter
	userInput.addEventListener('keypress', function (event) {
		if (event.key === 'Enter') {
			sendMessage();
		}
	});
</script>
<!-- Examples -->
@* ************** Content ************** *@

