@model AspnetCoreMvcStarter.Models.CrowdFunding.ProjectAi
@{
    ViewData["Title"] = "Ù„ÛŒØ³Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§";
    Layout = null;
}
<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - My Application</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="~/css/chatbox.css"> <!-- Ù„ÛŒÙ†Ú© Ø¨Ù‡ CSS -->
</head>
<body style="direction: rtl">
<style>
    .custom-card {
        border-radius: 15px; /* Ø­Ø§Ø´ÛŒÙ‡ Ø®Ù…ÛŒØ¯Ù‡ */
        overflow: hidden; /* Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² overflow */
        max-height: 80vh; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ 80% Ø§Ø² Ø§Ø±ØªÙØ§Ø¹ ØµÙØ­Ù‡ */
    }

    .card-body {
        max-height: 60vh; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ù…Ø­ØªÙˆØ§ */
        overflow-y: auto; /* ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ */
    }

        .text-right {
            text-align: right; /* ØªÙ†Ø¸ÛŒÙ… Ù…ØªÙ† Ø¨Ù‡ Ø³Ù…Øª Ø±Ø§Ø³Øª */
        }

        .response-message1 {
            white-space: pre-wrap;
            direction: ltr;
            text-align: justify;
            background-color: #e6f7ff; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 5px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
            border: 1px solid #91d5ff; /* Ø­Ø§Ø´ÛŒÙ‡ */
        }
</style>

    <div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-4"> <!-- Ø¹Ø±Ø¶ Card Ø³Ù…Øª Ú†Ù¾ 80% -->
                <button class="chat-button" onclick="toggleChat()">ğŸ’¬</button>
                <div class="chat-box" id="chatBox">
                    <div class="chat-header">
                        <span>Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
                        <button onclick="toggleChat()">âœ–</button>
                    </div>

@*                     <div class="chat-dropdown">
                        <label for="messageDropdown">Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</label>
                        <select id="messageDropdown" onchange="sendDropdownMessage()">
                            @foreach (var item in ViewBag.DropdownItems)
                            {
                                <option value="@item.Id">@item.Value</option>
                            }
                        </select>
                    </div> *@

                    <div class="chat-messages text-right" id="chatMessages">
                        @foreach (var message in Model.messages)
                        {
                            <div class="message @(message.IsResponse ? "response-message1" : "")" >
                                <p class="answer-box" >@message.Content</p>
                            </div>
                        }
                    </div>

                    <div class="overlay" id="overlay" style="display: none;">
                        <div class="spinner" id="spinner"></div>
                    </div>

                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Ø³ÙˆØ§Ù„ØªØ§Ù† Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯...">
                        <button id="sendButton">Ø§Ø±Ø³Ø§Ù„</button>
                    </div>
                </div>

        </div>
        
        <div class="col-md-8"> <!-- Card Ø³Ù…Øª Ø±Ø§Ø³Øª Ø®Ø§Ù„ÛŒ -->
                <div class="card shadow left-card mb-4" style="height: 90vh;">
                    <div class="card-header text-right">
                        <h5 class="card-title">Ù„ÛŒØ³Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h5>
                        <button id="generateButton" class="btn btn-primary" onclick="generateProjects()">Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡ ØªØµØ§Ø¯ÙÛŒ</button>

                    </div>
                    <div class="card-body text-right" style="max-height: 80vh;">
                        <table id="projectsTable" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Ø´Ù†Ø§Ø³Ù‡ </th>
                                    <th>ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
                                    <th>Ù†Ù…Ø§Ø¯ Ø·Ø±Ø­</th>
                                    <th>Ù†Ø§Ù… Ø³Ú©Ùˆ</th>
                                    <th>Ù…ØªÙ‚Ø§Ø¶ÛŒ</th>
                                    <th>Ø´Ù†Ø§Ø³Ù‡ Ù…Ù„ÛŒ </th>
                                    <th>Ø¹Ù†ÙˆØ§Ù† Ø·Ø±Ø­</th>
                                    <th>ØªØ§Ø±ÛŒØ® ØªØ§ÛŒÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
                                    <th>Ù…Ø¨Ù„Øº Ú©Ù„ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² ØªØ§Ù…ÛŒÙ† Ù…Ø§Ù„ÛŒ</th>
                                    <th>Ú©Ù„ Ù…Ø¨Ù„Øº Ø¬Ù…Ø¹ Ø¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡</th>
                                    <th>Ù…Ø¨Ù„Øº Ø¬Ù…Ø¹ Ø¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡ Ø­Ù‚ÛŒÙ‚ÛŒ</th>
                                    <th>Ù…Ø¨Ù„Øº Ø¬Ù…Ø¹ Ø¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡ Ø­Ù‚ÙˆÙ‚ÛŒ</th>
                                    <th>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§Ø±Ú©Øª Ú©Ù†Ù†Ø¯Ù‡ Ø­Ù‚ÛŒÙ‚ÛŒ</th>
                                    <th>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§Ø±Ú©Øª Ú©Ù†Ù†Ø¯Ù‡ Ø­Ù‚ÙˆÙ‚ÛŒ</th>
                                    <th>ØªØ§Ø±ÛŒØ® Ø¬Ù…Ø¹ Ø¢ÙˆØ±ÛŒ</th>
                                    <th>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§</th>
                                    <th>ØªØ§Ø±ÛŒØ® Ø§ØªÙ…Ø§Ù… </th>
                                    <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                    <th>Ù†ÙˆØ¹ ÙˆØ«ÛŒÙ‚Ù‡</th>
                                    <th>Ø³ÙˆØ¯ Ø¹Ù„ÛŒ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                    <th>ØªÙˆØ§ØªØ± Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                                    <th>Ø´Ù†Ø§Ø³Ù‡ Ù†Ù‡Ø§Ø¯ Ù…Ø§Ù„ÛŒ</th>
                                    <th>Ù†Ø§Ù… Ù†Ù‡Ø§Ø¯ Ù…Ø§Ù„ÛŒ</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var project in Model.projects)
                                {
                                    <tr>
                                        <td>@project.ProjectID</td>
                                        <td>@project.RequestDate</td>
                                        <td>@project.Symbol</td>
                                        <td>@project.PlatformName</td>
                                        <td>@project.Applicant</td>
                                        <td>@project.NationalID</td>
                                        <td>@project.ProjectTitle</td>
                                        <td>@project.ApprovalDate</td>
                                        <td>@project.TotalFundingRequired.ToString("N0") </td>
                                        <td>@project.TotalRaisedAmount.ToString("N0") </td>
                                        <td>@project.ActualRaisedAmount.ToString("N0") </td>
                                        <td>@project.LegalRaisedAmount.ToString("N0") </td>
                                        <td>@project.IndividualContributorsCount </td>
                                        <td>@project.LegalContributorsCount </td>
                                        <td>@project.FundCollectionDate </td>
                                        <td>@project.ProjectStartDate </td>
                                        <td>@project.ProjectEndDate </td>
                                        <td>@project.Status </td>
                                        <td>@project.CollateralType</td>
                                        <td>@project.InterestRate</td>
                                        <td>@project.PaymentFrequency</td>
                                        <td>@project.FinancialInstitutionID</td>
                                        <td>@project.FinancialInstitutionName</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
    </div>
</div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ DataTables -->
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª DataTable -->
    <script>

        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² jQuery Ø¯Ø± Ø­Ø§Ù„Øª Ø¨Ø¯ÙˆÙ†Conflict
        jQuery.noConflict();
        jQuery(document).ready(function ($) {
            $('#projectsTable').DataTable({
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.10.21/i18n/Persian.json" // Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
                }, 
                "pageLength": 5, // ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú©Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                "lengthMenu": [
                    [5,10, 20, 50, 100, -1], // Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§
                    [5,10, 20, 50, 100, "Ù‡Ù…Ù‡"] // Ù…ØªÙ† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                ]
            });
        });
    </script>

    <script>
        function generateProjects() {
				  fetch('@Url.Action("GenerateProjects", "cf")', {
					method: 'POST', // Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
					headers: {
						'Content-Type': 'application/json' // Ù†ÙˆØ¹ Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ
					},
					body: JSON.stringify({ /* Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ */ })
				})
				.then(response => {
					if (!response.ok) {
						throw new Error('Network response was not ok');
					}
					return response.json(); // ÛŒØ§ response.text() Ø§Ú¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ù…ØªÙ† Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯
				})
				.then(data => {
					// Ù¾Ø³ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯
					location.reload(); // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
				})
				.catch(error => {
					alert('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
					console.error('There was a problem with the fetch operation:', error);
				});
		}

        function toggleChat() {
            const chatBox = document.getElementById('chatBox');
            chatBox.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('sendButton').addEventListener('click', function () {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                const dropdown = document.getElementById('messageDropdown');
                const selectedMessageId = "CF"// dropdown.value; // Ø¯Ø±ÛŒØ§ÙØª ID Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                if (message) {
                    displayMessage(message, false); // false Ø¨Ù‡ Ø§ÛŒÙ† Ù…Ø¹Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª

                    sendMessage(message, selectedMessageId);
                    input.value = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒ
                }
            });

            document.getElementById('chatInput').addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    document.getElementById('sendButton').click();
                }
            });
        });

        async function sendMessage(messageContent, selectedMessageId) {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'flex'; // Ù†Ù…Ø§ÛŒØ´ Ù„Ø§ÛŒÙ‡ Ù¾ÙˆØ´Ø´ÛŒ Ùˆ Ø§Ø³Ù¾ÛŒÙ†Ø±
				   // Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ
			const data = {	
				messageContent: messageContent,
				selectedMessageId: selectedMessageId
			};
			try {
			   const response = await fetch('https://cfai.ir/api/CfApi/SendMessage', {
				method: 'POST',
				headers: {
				  'Content-Type': 'application/json',
				},
				body: JSON.stringify(data) // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ÙØ±Ù…Øª JSON

			  });

			  if (!response.ok) {
				throw new Error('Network response was not ok');
			  }

			  const data = await response.json(); // ØªØ¨Ø¯ÛŒÙ„ Ù¾Ø§Ø³Ø® Ø¨Ù‡ JSON
				// Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ±
				displayMessage(data, true); // true Ø¨Ù‡ Ø§ÛŒÙ† Ù…Ø¹Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù¾ÛŒØ§Ù… Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ø§Ø³Øª
				overlay.style.display = 'none'; // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ù¾ÙˆØ´Ø´ÛŒ
			} catch (error) {
				alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
				overlay.style.display = 'none'; // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ù¾ÙˆØ´Ø´ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
				console.log('There was a problem with the fetch operation:', error);
			}
        }

        function displayMessage(message, isResponse) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = isResponse ? 'response-message1' : 'message'; // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ Ù…Ù†Ø§Ø³Ø¨
            messageDiv.textContent = message; // ØªÙ†Ø¸ÛŒÙ… Ù…ØªÙ† Ù¾ÛŒØ§Ù…
            chatMessages.appendChild(messageDiv); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø¨Ø®Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
            chatMessages.scrollTop = chatMessages.scrollHeight; // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
        }

        function sendDropdownMessage() {
            // const dropdown = document.getElementById('messageDropdown');
            // const selectedMessageId = dropdown.value; // Ø¯Ø±ÛŒØ§ÙØª ID Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡

            // if (selectedMessageId) {
            //     sendMessage("", selectedMessageId); // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            // }
        }
    </script>
</body>
</html>

